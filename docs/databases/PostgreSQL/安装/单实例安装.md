## 1. 安装环境

```bash
root@ubuntu:~# lsb_release -d
Description:	Ubuntu 18.04.5 LTS
```

编译最小依赖

```bash
apt install -y gcc make zlib1g-dev libreadline-dev
```

## 2. 下载源码包

```bash
mkdir -p /opt/package && cd /opt/package
wget https://ftp.postgresql.org/pub/source/v12.13/postgresql-12.13.tar.gz
```

## 3 编译安装

```bash
cd /opt/package
tar xf postgresql-12.13.tar.gz
cd postgresql-12.13
mkdir build_dir
cd build_dir
mkdir -p /opt/software/postgresql/12.13
../configure --prefix=/opt/software/postgresql/12.13
make && make install
adduser postgres
mkdir -p /opt/software/postgresql/12.13/data
chown postgres:postgres /opt/software/postgresql/12.13/data
```

## 4. 配置环境变量

```bash
cat >> /etc/profile << "EOF"
export PGHOME=/opt/software/postgresql/12.13
export PATH=$PGHOME/bin:$PATH
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$PGHOME/lib
export PGDATA=$PGHOME/data
EOF
source  /etc/profile
```

## 5.修改系统变量

```bash
cat >> /etc/sysctl.conf << EOF
kernel.shmmax=17179869184
kernel.shmall=4194304
EOF
```

关闭`remoteIPC`

```bash
sed -i 's/#RemoveIPC=yes/RemoveIPC=no/g' /etc/systemd/logind.conf
```

## 6.初始化数据库

```bash
su - postgres -c 'initdb -D $PGDATA'
```

## 7.启动数据库

```bash
su - postgres -c 'pg_ctl start -D $PGDATA -l logfile'
```

## 8. 停止数据库

```bash
su - postgres -c 'pg_ctl stop -D $PGDATA'
```

